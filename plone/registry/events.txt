===============
Registry events
===============

The registry fires certain events. These are:

 * `plone.registry.interfaces.IRecordAddedEvent`, when a record has been
    added to the registry.

 * `plone.registry.interfaces.IRecordRemovedEvent`, when a record has been
    removed from the registry.
    
 * `plone.registry.interfaces.IRecordModifiedEvent`, when a record's value is
    modified.

To test these events, we will create, modify and remove a few records:

    >>> from plone.registry import Registry, Record, field
    >>> registry = Registry()

Adding a new record to the registry should fire IRecordAddedEvents:

    >>> registry.records['plone.registry.tests.age'] = \
    ...     Record(field.Int(title=u"Age", min=0, default=18))

    >>> registry.records['plone.registry.tests.cms'] = \
    ...     Record(field.TextLine(title=u"Preferred CMS"), value=u"Plone")

When creating records from an interface, one event is fired for each field
in the interface.

    >>> from plone.registry.tests import IMailSettings
    >>> registry.register_interface(IMailSettings)

Deleting a record should fire an IRecordRemovedEvent:

    >>> del registry.records['plone.registry.tests.cms']

Changing a record should fire an IRecordModifiedEvent:

    >>> registry['plone.registry.tests.age'] = 25
    >>> registry.records['plone.registry.tests.age'].value = 24

Let's take a look at the events that were just fired:

    >>> from plone.registry.interfaces import IRecordEvent
    >>> from zope.component.eventtesting import getEvents
    >>> getEvents(IRecordEvent)
    [<RecordAddedEvent for plone.registry.tests.age>,
     <RecordAddedEvent for plone.registry.tests.cms>,
     <RecordAddedEvent for plone.registry.tests.IMailSettings.sender>,
     <RecordAddedEvent for plone.registry.tests.IMailSettings.smtp_host>,
     <RecordRemovedEvent for plone.registry.tests.cms>,
     <RecordModifiedEvent for plone.registry.tests.age>,
     <RecordModifiedEvent for plone.registry.tests.age>]

For the modified events, we can also check the value before and after the
change.

    >>> from plone.registry.interfaces import IRecordModifiedEvent
    >>> [(repr(e), e.old_value, e.new_value,) for e in getEvents(IRecordModifiedEvent)]
    [('<RecordModifiedEvent for plone.registry.tests.age>', 18, 25),
     ('<RecordModifiedEvent for plone.registry.tests.age>', 25, 24)]